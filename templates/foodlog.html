{% extends "base.html" %}

{% block title %}Food Log - NutriTrack{% endblock %}

{% block extra_css %}
<style>
    .search-header-section {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .search-header-section h2 {
        color: white;
        margin-bottom: 20px;
        font-size: 1.8rem;
    }
    
    .transparent-search {
        max-width: 700px;
        margin: 0 auto;
    }
    
    .transparent-input-group {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }
    
    .transparent-input-group input {
        flex: 1;
        padding: 15px 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 16px;
        backdrop-filter: blur(5px);
    }
    
    .transparent-input-group input::placeholder {
        color: rgba(255, 255, 255, 0.7);
    }
    
    .transparent-input-group input:focus {
        outline: none;
        border-color: white;
        background: rgba(255, 255, 255, 0.2);
    }
    
    .transparent-search-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .transparent-search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }
    
    .transparent-search-results {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        max-height: 400px;
        overflow-y: auto;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .quick-food-chips {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 15px;
        justify-content: center;
    }
    
    .food-chip {
        padding: 8px 15px;
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 20px;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
    }
    
    .food-chip:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-1px);
    }
    
    .foodlog-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 25px;
    }
    
    .search-results-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .food-result {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background: white;
        border-radius: 8px;
        border: 1px solid #eee;
        transition: all 0.3s ease;
    }
    
    .food-result:hover {
        background: #f8f9ff;
        transform: translateY(-2px);
    }
    
    .food-info {
        flex: 1;
    }
    
    .food-category {
        display: inline-block;
        padding: 2px 8px;
        background: #e6e9ff;
        color: #667eea;
        border-radius: 4px;
        font-size: 0.8rem;
        margin-left: 10px;
    }
    
    .food-nutrition {
        display: flex;
        gap: 15px;
        margin-top: 8px;
        font-size: 0.9rem;
        color: #666;
    }
    
    .date-selector {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
        padding: 15px;
        background: #f8f9ff;
        border-radius: 10px;
        border: 2px solid #e6e9ff;
    }
    
    .date-selector button {
        background: #667eea;
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .date-selector button:hover {
        background: #5569d5;
        transform: scale(1.1);
    }
    
    #currentDate {
        font-weight: 600;
        color: #333;
        font-size: 1.1rem;
    }
    
    .meal-categories {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-top: 10px;
    }
    
    .meal-category {
        background: #f8f9ff;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid #e6e9ff;
    }
    
    .meal-category:hover {
        background: #e6e9ff;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }
    
    .meal-category i {
        font-size: 1.5rem;
        color: #667eea;
        margin-bottom: 10px;
    }
    
    .meal-category h3 {
        color: #333;
        margin: 5px 0;
        font-size: 1.1rem;
    }
    
    .meal-category p {
        color: #666;
        font-size: 0.9rem;
        margin: 0;
    }

    /* Modal Styles */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }

    .modal-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .modal-container {
        background: white;
        border-radius: 15px;
        width: 90%;
        max-width: 500px;
        transform: translateY(-20px);
        transition: transform 0.3s ease;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-overlay.active .modal-container {
        transform: translateY(0);
    }

    .modal-header {
        padding: 25px 30px 15px;
        border-bottom: 1px solid #eee;
    }

    .modal-header h3 {
        margin: 0;
        color: #333;
        font-size: 1.4rem;
    }

    .modal-body {
        padding: 25px 30px;
    }

    .modal-footer {
        padding: 15px 30px 25px;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: flex-end;
        gap: 15px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #555;
        font-weight: 500;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e6e9ff;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.3s ease;
        background: #f8f9ff;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
        background: white;
    }

    .btn-modal {
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-modal-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .btn-modal-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-modal-secondary {
        background: #f0f2ff;
        color: #667eea;
    }

    .btn-modal-secondary:hover {
        background: #e6e9ff;
        transform: translateY(-2px);
    }

    .toast {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        transform: translateY(100px);
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 1001;
    }

    .toast.show {
        transform: translateY(0);
        opacity: 1;
    }

    /* Loading spinner */
    .loading-spinner {
        text-align: center;
        padding: 20px;
        color: #667eea;
    }

    .loading-spinner i {
        margin-right: 10px;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Error message */
    .error-message {
        background: #ffebee;
        color: #c62828;
        padding: 10px 15px;
        border-radius: 5px;
        margin: 10px 0;
        border-left: 4px solid #c62828;
    }

    .error-message i {
        margin-right: 10px;
    }

    /* Success message */
    .success-message {
        background: #e8f5e9;
        color: #2e7d32;
        padding: 10px 15px;
        border-radius: 5px;
        margin: 10px 0;
        border-left: 4px solid #2e7d32;
    }

    .success-message i {
        margin-right: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class='page-container'>
    <div class='page-header'>
        <h1><i class='fas fa-utensils'></i> Food Log</h1>
        <p>Track your daily food intake and nutrition</p>
    </div>

    <!-- Transparent Search Section (Centered at Top) -->
    <div class='search-header-section'>
        <h2><i class='fas fa-search'></i> Search & Add Food</h2>
        
        <div class='transparent-search'>
            <div class='transparent-input-group'>
                <input type='text' id='foodSearch' placeholder='Search for food items (e.g., apple, chicken, rice)...'
                       onkeyup='if(event.key === "Enter") searchFood()'>
                <button onclick='searchFood()' class='transparent-search-btn'>
                    <i class='fas fa-search'></i> Search
                </button>
            </div>
            
            <div id='searchResults' class='transparent-search-results'>
                <p class='search-hint' style="color: #666; text-align: center;">Enter a food name above to search...</p>
            </div>
            
            <div class='quick-foods' style="margin-top: 20px;">
                <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 10px;">Common foods:</p>
                <div class='quick-food-chips'>
                    <button onclick='searchQuickFood("apple")' class='food-chip'>Apple</button>
                    <button onclick='searchQuickFood("banana")' class='food-chip'>Banana</button>
                    <button onclick='searchQuickFood("chicken breast")' class='food-chip'>Chicken Breast</button>
                    <button onclick='searchQuickFood("rice")' class='food-chip'>Rice</button>
                    <button onclick='searchQuickFood("eggs")' class='food-chip'>Eggs</button>
                    <button onclick='searchQuickFood("broccoli")' class='food-chip'>Broccoli</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cards Grid Below -->
    <div class='foodlog-grid'>
        <!-- Today's Food Log -->
        <div class='card'>
            <div class='card-header'>
                <h2><i class='fas fa-list'></i> Today's Food Log</h2>
                <div class='card-actions'>
                    <button onclick='loadDailySummary()' class='btn-icon' title='Refresh'>
                        <i class='fas fa-sync-alt'></i>
                    </button>
                    <button onclick='openClearLogsModal()' class='btn-icon btn-danger' title='Clear All'>
                        <i class='fas fa-trash'></i>
                    </button>
                </div>
            </div>
            <div class='card-body'>
                <div class='date-selector'>
                    <button onclick='changeDate(-1)'><i class='fas fa-chevron-left'></i></button>
                    <span id='currentDate'>Loading...</span>
                    <button onclick='changeDate(1)'><i class='fas fa-chevron-right'></i></button>
                </div>
                
                <div id='foodLogContainer'>
                    <p class='empty-state'>Loading food log...</p>
                </div>
                
                <div class='nutrition-summary' id='nutritionSummary'>
                    <p>Nutrition data will appear here after logging food</p>
                </div>
            </div>
        </div>

        <!-- Meal Categories -->
        <div class='card'>
            <div class='card-header'>
                <h2><i class='fas fa-clock'></i> Log by Meal</h2>
            </div>
            <div class='card-body'>
                <div class='meal-categories'>
                    <div class='meal-category' onclick='openMealModal("Breakfast")'>
                        <i class='fas fa-sun'></i>
                        <h3>Breakfast</h3>
                        <p>Morning meal</p>
                    </div>
                    <div class='meal-category' onclick='openMealModal("Lunch")'>
                        <i class='fas fa-sun'></i>
                        <h3>Lunch</h3>
                        <p>Midday meal</p>
                    </div>
                    <div class='meal-category' onclick='openMealModal("Dinner")'>
                        <i class='fas fa-moon'></i>
                        <h3>Dinner</h3>
                        <p>Evening meal</p>
                    </div>
                    <div class='meal-category' onclick='openMealModal("Snacks")'>
                        <i class='fas fa-cookie'></i>
                        <h3>Snacks</h3>
                        <p>Between meals</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Nutrition Progress -->
        <div class='card'>
            <div class='card-header'>
                <h2><i class='fas fa-chart-bar'></i> Daily Progress</h2>
            </div>
            <div class='card-body'>
                <div id='nutritionProgress'>
                    <p>Log food to see your progress</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Meal Log Modal -->
    <div id="mealModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="mealModalTitle">Log Food</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="mealFoodName">Food Name</label>
                    <input type="text" id="mealFoodName" placeholder="Enter food name..." onkeyup="if(event.key === 'Enter') submitMealFood()">
                </div>
                <div class="form-group">
                    <label for="mealQuantity">Quantity (servings)</label>
                    <input type="number" id="mealQuantity" value="1" min="0.1" step="0.1">
                </div>
                <div class="form-group">
                    <label for="mealTime">Meal Time</label>
                    <input type="time" id="mealTime" value="13:00">
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeMealModal()" class="btn-modal btn-modal-secondary">Cancel</button>
                <button onclick="submitMealFood()" class="btn-modal btn-modal-primary">Add to Log</button>
            </div>
        </div>
    </div>

    <!-- Quantity Modal -->
    <div id="quantityModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="quantityModalTitle">Add to Food Log</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label id="quantityModalLabel">How many servings?</label>
                    <input type="number" id="quantityInput" value="1" min="0.1" step="0.1" placeholder="Enter quantity (e.g., 1, 0.5, 2)" 
                           onkeyup="if(event.key === 'Enter') submitQuantity()"
                           onfocus="this.select()">
                </div>
                <div style="font-size: 0.85rem; color: #666; margin-top: -10px; margin-bottom: 10px;">
                    <i class="fas fa-info-circle"></i> Use decimal numbers (e.g., 0.5 for half serving)
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeQuantityModal()" class="btn-modal btn-modal-secondary">Cancel</button>
                <button onclick="submitQuantity()" class="btn-modal btn-modal-primary">Add</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Confirm Deletion</h3>
            </div>
            <div class="modal-body">
                <p id="deleteModalText">Are you sure you want to delete this item?</p>
            </div>
            <div class="modal-footer">
                <button onclick="closeDeleteModal()" class="btn-modal btn-modal-secondary">Cancel</button>
                <button onclick="confirmDelete()" class="btn-modal" style="background: #ff6b6b; color: white;">Delete</button>
            </div>
        </div>
    </div>

    <!-- Clear Logs Modal -->
    <div id="clearLogsModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Clear All Logs</h3>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to clear all food logs for <span id="clearLogsDate"></span>?</p>
                <p style="color: #ff6b6b; margin-top: 10px; font-size: 0.9rem;"><i class="fas fa-exclamation-triangle"></i> This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button onclick="closeClearLogsModal()" class="btn-modal btn-modal-secondary">Cancel</button>
                <button onclick="clearDailyLogs()" class="btn-modal" style="background: #ff6b6b; color: white;">Clear All</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>
</div>
{% endblock %}
{% block extra_js %}
<script>
// Global variables
let currentDate = new Date();
let currentMealType = '';
let deleteCallback = null;
let foodToLog = '';

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    console.log('=== Food Log Initialization ===');
    updateDateDisplay();
    loadDailySummary();
    
    // Add event listener for search input
    document.getElementById('foodSearch').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            searchFood();
        }
    });
    
    // Event delegation for add buttons - SIMPLIFIED
    document.getElementById('searchResults').addEventListener('click', function(e) {
        // Check if the clicked element is an add button
        if (e.target.classList.contains('add-food-btn') || 
            e.target.closest('.add-food-btn')) {
            
            const addBtn = e.target.classList.contains('add-food-btn') ? 
                           e.target : e.target.closest('.add-food-btn');
            
            e.preventDefault();
            e.stopPropagation();
            
            // Get food name from data attribute
            let foodName = addBtn.getAttribute('data-food');
            
            console.log('=== Add Button Clicked ===');
            console.log('Button element:', addBtn);
            console.log('data-food attribute:', foodName);
            
            // If not in data attribute, try to get from the strong element
            if (!foodName) {
                const foodResult = addBtn.closest('.food-result');
                if (foodResult) {
                    const strongElement = foodResult.querySelector('.food-info strong');
                    if (strongElement) {
                        foodName = strongElement.textContent.trim();
                        console.log('Got food name from text:', foodName);
                    }
                }
            }
            
            if (foodName && foodName.trim()) {
                console.log('Processing food:', foodName);
                handleAddFoodClick(foodName.trim());
            } else {
                console.error('Could not get food name');
                console.log('Button HTML:', addBtn.outerHTML);
                showToast('Error: Could not get food name', 'error');
            }
        }
    });
});

// Date functions
function updateDateDisplay() {
    const dateStr = currentDate.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    document.getElementById('currentDate').textContent = dateStr;
}

function changeDate(days) {
    currentDate.setDate(currentDate.getDate() + days);
    updateDateDisplay();
    loadDailySummary();
}

// Search functions
function searchFood() {
    const query = document.getElementById('foodSearch').value.trim();
    if (!query) {
        document.getElementById('searchResults').innerHTML = '<p class="search-hint" style="color: #666; text-align: center;">Enter a food name above to search...</p>';
        return;
    }
    
    console.log('Searching for:', query);
    
    // Show loading
    document.getElementById('searchResults').innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i> Searching...</div>';
    
    fetch('/api/search?q=' + encodeURIComponent(query))
        .then(response => {
            console.log('Search response status:', response.status);
            if (!response.ok) {
                throw new Error('Search failed: ' + response.status);
            }
            return response.json();
        })
        .then(foods => {
            console.log('Search results received:', foods.length, 'items');
            displaySearchResults(foods);
        })
        .catch(error => {
            console.error('Search error:', error);
            document.getElementById('searchResults').innerHTML = '<div class="error-message"><i class="fas fa-exclamation-circle"></i> Error searching for food</div>';
        });
}


// Simple click handler
// Keep this as a fallback
function handleAddFoodClick(foodName) {
    console.log('handleAddFoodClick called with:', foodName);
    debugAddButtonClick('unknown', foodName);
}
// Test the entire flow
function testCompleteFlow() {
    console.log('=== TESTING COMPLETE FLOW ===');
    
    // Step 1: Search for eggs
    console.log('1. Searching for "eggs"...');
    document.getElementById('foodSearch').value = 'eggs';
    searchFood();
    
    // Step 2: Wait for results, then simulate click
    setTimeout(() => {
        console.log('2. Checking search results...');
        const resultsDiv = document.getElementById('searchResults');
        const firstButton = resultsDiv.querySelector('.add-food-btn');
        
        if (firstButton) {
            console.log('3. Found button:', firstButton);
            console.log('Button data:', {
                id: firstButton.id,
                'data-food-name': firstButton.getAttribute('data-food-name'),
                'data-food-id': firstButton.getAttribute('data-food-id')
            });
            
            // Simulate click
            console.log('4. Simulating button click...');
            firstButton.click();
        } else {
            console.error('No add button found!');
        }
    }, 2000);
}

// Make test available
window.testCompleteFlow = testCompleteFlow;
console.log('Test function available: window.testCompleteFlow()');
// FIXED: displaySearchResults function
// DEBUGGING VERSION of displaySearchResults
function displaySearchResults(foods) {
    const resultsDiv = document.getElementById('searchResults');
    
    if (!foods || foods.length === 0) {
        resultsDiv.innerHTML = '<p class="no-results" style="text-align: center; color: #666;">No foods found. Try a different search.</p>';
        return;
    }
    
    let html = '<div class="search-results-list">';
    foods.forEach(food => {
        // Use the exact food name from the database
        const foodName = food.name;
        const foodId = food.id;
        
        // Create a unique ID for debugging
        const buttonId = `add-btn-${foodId}`;
        
        html += `
            <div class="food-result" id="food-${foodId}">
                <div class="food-info">
                    <strong style="color: #333;" id="food-name-${foodId}">${food.name}</strong>
                    <span class="food-category">${food.category}</span>
                    <div class="food-nutrition">
                        <span>${food.calories} cal</span>
                        <span>P: ${food.protein}g</span>
                        <span>C: ${food.carbs}g</span>
                        <span>F: ${food.fat}g</span>
                    </div>
                </div>
                <button id="${buttonId}"
                        class="add-food-btn btn-small" 
                        data-food-id="${foodId}"
                        data-food-name="${foodName}"
                        onclick="debugAddButtonClick('${foodId}', '${foodName.replace(/'/g, "\\'")}')"
                        style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; display: flex; align-items: center; gap: 5px; transition: all 0.3s ease;" 
                        onmouseover="this.style.background='#5569d5'" 
                        onmouseout="this.style.background='#667eea'">
                    <i class="fas fa-plus"></i> Add
                </button>
            </div>
        `;
    });
    html += '</div>';
    resultsDiv.innerHTML = html;
    
    console.log('=== SEARCH RESULTS DISPLAYED ===');
    console.log('Number of foods:', foods.length);
    console.log('First food:', foods[0]);
    
    // Debug: Log all buttons
    const buttons = resultsDiv.querySelectorAll('.add-food-btn');
    buttons.forEach((btn, index) => {
        console.log(`Button ${index}:`, {
            id: btn.id,
            'data-food-name': btn.getAttribute('data-food-name'),
            'data-food-id': btn.getAttribute('data-food-id'),
            text: btn.textContent
        });
    });
}
// DEBUG function for button clicks
function debugAddButtonClick(foodId, foodName) {
    console.log('=== DEBUG BUTTON CLICK ===');
    console.log('foodId:', foodId);
    console.log('foodName parameter:', foodName);
    console.log('Type of foodName:', typeof foodName);
    
    // Get the button that was clicked
    const button = document.getElementById(`add-btn-${foodId}`);
    console.log('Button element:', button);
    console.log('Button data-food-name:', button.getAttribute('data-food-name'));
    
    // Get the food name from the displayed text
    const foodNameElement = document.getElementById(`food-name-${foodId}`);
    console.log('Food name element text:', foodNameElement ? foodNameElement.textContent : 'NOT FOUND');
    
    // Try multiple ways to get the food name
    let finalFoodName = '';
    
    // Method 1: Use parameter
    if (foodName && foodName.trim()) {
        finalFoodName = foodName;
        console.log('Using parameter foodName:', finalFoodName);
    }
    // Method 2: Use data attribute
    else if (button && button.getAttribute('data-food-name')) {
        finalFoodName = button.getAttribute('data-food-name');
        console.log('Using data attribute foodName:', finalFoodName);
    }
    // Method 3: Use text element
    else if (foodNameElement) {
        finalFoodName = foodNameElement.textContent.trim();
        console.log('Using text element foodName:', finalFoodName);
    }
    
    console.log('Final food name to use:', finalFoodName);
    
    if (!finalFoodName || finalFoodName.trim() === '') {
        console.error('ERROR: Could not get food name from any source!');
        alert('DEBUG: Could not get food name. Check console.');
        return;
    }
    
    // Now use the EXACT SAME approach as logFoodWithMeal
    console.log('Searching database for exact match of:', finalFoodName);
    
    fetch('/api/search?q=' + encodeURIComponent(finalFoodName))
        .then(response => response.json())
        .then(searchResults => {
            console.log('Database search results:', searchResults);
            
            let exactFoodName = finalFoodName;
            
            if (searchResults && searchResults.length > 0) {
                exactFoodName = searchResults[0].name;
                console.log('Found exact name in database:', exactFoodName);
            } else {
                console.log('No exact match, using:', exactFoodName);
            }
            
            // Store in global variable
            foodToLog = exactFoodName;
            console.log('foodToLog set to:', foodToLog);
            
            // Open modal
            openQuantityModal(exactFoodName);
        })
        .catch(error => {
            console.error('Search error:', error);
            // Fallback
            foodToLog = finalFoodName;
            openQuantityModal(finalFoodName);
        });
}
function searchQuickFood(foodName) {
    document.getElementById('foodSearch').value = foodName;
    searchFood();
}

// Modal functions
function openMealModal(mealType) {
    currentMealType = mealType;
    document.getElementById('mealModalTitle').textContent = `Log Food for ${mealType}`;
    document.getElementById('mealModal').classList.add('active');
    document.getElementById('mealFoodName').focus();
    
    // Set default times based on meal type
    const timeInput = document.getElementById('mealTime');
    switch(mealType) {
        case 'Breakfast':
            timeInput.value = '08:00';
            break;
        case 'Lunch':
            timeInput.value = '13:00';
            break;
        case 'Dinner':
            timeInput.value = '19:00';
            break;
        default:
            timeInput.value = new Date().toTimeString().slice(0, 5);
    }
}

function closeMealModal() {
    document.getElementById('mealModal').classList.remove('active');
    currentMealType = '';
    // Clear form
    document.getElementById('mealFoodName').value = '';
    document.getElementById('mealQuantity').value = '1';
}

function openQuantityModal(foodName) {
    console.log('=== openQuantityModal called ===');
    console.log('Parameter foodName:', foodName);
    console.log('Type of foodName:', typeof foodName);
    
    // Validate and clean foodName
    if (!foodName) {
        console.error('Error: foodName is null or undefined');
        showToast('Error: No food selected', 'error');
        return;
    }
    
    if (typeof foodName !== 'string') {
        console.error('Error: foodName is not a string:', foodName);
        foodName = String(foodName);
    }
    
    foodName = foodName.trim();
    
    if (foodName === '') {
        console.error('Error: foodName is empty after trimming');
        showToast('Error: Invalid food name', 'error');
        return;
    }
    
    console.log('Cleaned foodName:', foodName);
    console.log('Length:', foodName.length);
    
    // Store in global variable
    foodToLog = foodName;
    console.log('foodToLog set to:', foodToLog);
    
    // Escape HTML for display
    const displayName = foodToLog.replace(/</g, '&lt;').replace(/>/g, '&gt;');
    
    document.getElementById('quantityModalTitle').textContent = `Add ${displayName}`;
    document.getElementById('quantityModalLabel').textContent = `How many servings of ${displayName}?`;
    document.getElementById('quantityModal').classList.add('active');
    document.getElementById('quantityInput').focus();
    document.getElementById('quantityInput').select();
}

function closeQuantityModal() {
    document.getElementById('quantityModal').classList.remove('active');
    foodToLog = '';
    document.getElementById('quantityInput').value = '1';
}

function submitQuantity() {
    const quantity = document.getElementById('quantityInput').value;
    console.log("DEBUG submitQuantity - foodToLog:", foodToLog, "quantity:", quantity);
    logFood(foodToLog, quantity); // CORRECT - 2 arguments!
    closeQuantityModal();
}

function openDeleteModal(message, callback) {
    document.getElementById('deleteModalText').textContent = message;
    deleteCallback = callback;
    document.getElementById('deleteModal').classList.add('active');
}

function closeDeleteModal() {
    document.getElementById('deleteModal').classList.remove('active');
    deleteCallback = null;
}

function openClearLogsModal() {
    const dateStr = currentDate.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    document.getElementById('clearLogsDate').textContent = dateStr;
    document.getElementById('clearLogsModal').classList.add('active');
}

function closeClearLogsModal() {
    document.getElementById('clearLogsModal').classList.remove('active');
}

function confirmDelete() {
    if (deleteCallback) {
        deleteCallback();
    }
    closeDeleteModal();
}

function submitMealFood() {
    const foodName = document.getElementById('mealFoodName').value.trim();
    const quantity = parseFloat(document.getElementById('mealQuantity').value);
    const mealTime = document.getElementById('mealTime').value;
    
    if (!foodName) {
        showToast('Please enter a food name', 'error');
        return;
    }
    
    if (!quantity || isNaN(quantity) || quantity <= 0) {
        showToast('Please enter a valid quantity', 'error');
        return;
    }
    
    closeMealModal();
    logFoodWithMeal(foodName, quantity, currentMealType, mealTime);
}

// Logging functions
function logFood(foodName, quantity) {
    const dateStr = currentDate.toISOString().split('T')[0];
    console.log('=== Attempting to log food ===');
    
    // CRITICAL FIX: Use foodToLog if foodName is empty
    if (!foodName || foodName.trim() === '') {
        foodName = window.foodToLog || foodToLog;
        console.log('Using foodToLog instead:', foodName);
    }
    
    console.log('Food:', foodName);
    console.log('Quantity:', quantity);
    console.log('Date:', dateStr);
    
    // Validate foodName
    if (!foodName || foodName.trim() === '') {
        showToast('Error: Food name is empty', 'error');
        console.error('Food name is empty! Available foodToLog:', window.foodToLog, foodToLog);
        console.trace('Trace to see who called logFood');
        return;
    }
    
    // Clean the food name - remove any extra whitespace
    foodName = foodName.trim();
    
    console.log('Sending request to server with cleaned food name:', foodName);
    
    fetch('/api/log_food', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            date: dateStr,
            food_name: foodName,
            quantity: quantity
        })
    })
    .then(response => {
        console.log('Log food response status:', response.status);
        return response.json().then(data => {
            console.log('Log food response data:', data);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}, message: ${data.error || 'Unknown error'}`);
            }
            return data;
        });
    })
    .then(data => {
        console.log('Log food success response:', data);
        if (data.status === 'success') {
            showToast(`✅ ${data.food} logged successfully!`);
            loadDailySummary();
            // Clear search results after logging
            document.getElementById('searchResults').innerHTML = '<p class="search-hint" style="color: #666; text-align: center;">Enter a food name above to search...</p>';
            document.getElementById('foodSearch').value = '';
            // Clear foodToLog after successful logging
            window.foodToLog = null;
        } else {
            showToast('Error: ' + (data.error || 'Failed to log food'), 'error');
        }
    })
    .catch(error => {
        console.error('Log food error:', error);
        showToast('Error logging food: ' + error.message, 'error');
    });
}

function logFoodWithMeal(foodName, quantity, mealType, mealTime) {
    const dateStr = currentDate.toISOString().split('T')[0];
    const timestamp = `${dateStr}T${mealTime}:00`;
    
    console.log('Logging food with meal:', { foodName, quantity, mealType, timestamp });
    
    // First, search for the food in the database to get the exact name
    fetch('/api/search?q=' + encodeURIComponent(foodName))
        .then(response => response.json())
        .then(searchResults => {
            console.log('Search results for meal food:', searchResults);
            
            let exactFoodName = foodName; // Default to what was entered
            
            // If we found matches, use the first one's exact name
            if (searchResults && searchResults.length > 0) {
                exactFoodName = searchResults[0].name;
                console.log('Using exact food name from database:', exactFoodName);
            } else {
                console.log('No exact match found, using entered name:', foodName);
            }
            
            // Now log with the exact food name
            fetch('/api/log_food', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    date: dateStr,
                    food_name: exactFoodName,
                    quantity: quantity,
                    meal_type: mealType,
                    timestamp: timestamp
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Log food with meal response:', data);
                if (data.status === 'success') {
                    showToast(`✅ ${exactFoodName} added to ${mealType} log!`);
                    loadDailySummary();
                } else {
                    showToast('Error: ' + (data.error || 'Failed to log food'), 'error');
                }
            })
            .catch(error => {
                console.error('Log food with meal error:', error);
                showToast('Error logging food', 'error');
            });
        })
        .catch(error => {
            console.error('Search error in logFoodWithMeal:', error);
            // If search fails, try to log with the original name
            logFoodDirectly(foodName, quantity, mealType, timestamp);
        });
}

// Helper function for direct logging
function logFoodDirectly(foodName, quantity, mealType, timestamp) {
    const dateStr = currentDate.toISOString().split('T')[0];
    
    fetch('/api/log_food', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            date: dateStr,
            food_name: foodName,
            quantity: quantity,
            meal_type: mealType,
            timestamp: timestamp
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Direct log food response:', data);
        if (data.status === 'success') {
            showToast(`✅ ${foodName} added to ${mealType} log!`);
            loadDailySummary();
        } else {
            showToast('Error: ' + (data.error || 'Failed to log food'), 'error');
        }
    })
    .catch(error => {
        console.error('Direct log food error:', error);
        showToast('Error logging food', 'error');
    });
}

// Load and display functions
function loadDailySummary() {
    const dateStr = currentDate.toISOString().split('T')[0];
    console.log('Loading daily summary for:', dateStr);
    
    fetch('/api/daily_summary?date=' + dateStr)
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to load daily summary');
            }
            return response.json();
        })
        .then(data => {
            console.log('Daily summary data loaded:', data);
            updateFoodLog(data);
        })
        .catch(error => {
            console.error('Error loading summary:', error);
            document.getElementById('foodLogContainer').innerHTML = '<p class="error" style="color: #ff6b6b; text-align: center;">Error loading food log</p>';
        });
}

function updateFoodLog(data) {
    const logContainer = document.getElementById('foodLogContainer');
    const nutritionDiv = document.getElementById('nutritionSummary');
    
    console.log('Updating food log display with:', data);
    
    if (data.logs && data.logs.length > 0) {
        let html = '<ul class="food-log-list" style="list-style: none; padding: 0;">';
        data.logs.forEach((log, index) => {
            const logTime = log.timestamp ? new Date(log.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'Just now';
            
            html += `
                <li style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: ${index % 2 === 0 ? '#f9f9f9' : 'white'}; border-radius: 8px; margin-bottom: 8px; border: 1px solid #eee;">
                    <div style="display: flex; flex-direction: column;">
                        <span class="food-log-name" style="font-weight: 600; color: #333; font-size: 1rem;">${log.food}</span>
                        <span style="color: #666; font-size: 0.85rem; margin-top: 4px;">
                            <i class="fas fa-clock" style="margin-right: 5px;"></i>${logTime}
                            ${log.meal_type ? `<span style="margin-left: 10px; background: #e6e9ff; color: #667eea; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem;">${log.meal_type}</span>` : ''}
                        </span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span class="food-log-quantity" style="background: #f0f2ff; color: #667eea; padding: 6px 12px; border-radius: 6px; font-size: 0.9rem; font-weight: 600; min-width: 60px; text-align: center; border: 1px solid #e6e9ff;">
                            <i class="fas fa-weight" style="margin-right: 5px;"></i>x${log.quantity}
                        </span>
                        <button onclick="removeFoodEntry('${log.food.replace(/'/g, "\\'")}', ${log.quantity})" 
                                class="btn-icon btn-small" 
                                style="padding: 8px 12px; background: #ff6b6b; color: white; border: none; border-radius: 6px; cursor: pointer; transition: all 0.3s ease;"
                                onmouseover="this.style.background='#ff5252'; this.style.transform='scale(1.05)'"
                                onmouseout="this.style.background='#ff6b6b'; this.style.transform='scale(1)'"
                                title="Remove this item">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </li>
            `;
        });
        html += '</ul>';
        logContainer.innerHTML = html;
    } else {
        logContainer.innerHTML = `
            <div style="text-align: center; color: #666; padding: 40px 20px;">
                <i class="fas fa-utensils fa-2x" style="margin-bottom: 15px; color: #ccc;"></i>
                <p style="font-size: 1.1rem; margin-bottom: 10px;">No food logged for this date.</p>
                <p style="font-size: 0.9rem; color: #888;">Search for food above to start logging!</p>
            </div>
        `;
    }
    
    if (data.nutrition && Object.keys(data.nutrition).length > 0) {
        const calorieProgress = data.user_profile ? Math.round((data.nutrition.calories / data.user_profile.daily_calories) * 100) : 0;
        const progressColor = calorieProgress > 100 ? '#ff6b6b' : calorieProgress > 80 ? '#FF9800' : '#4CAF50';
        
        nutritionDiv.innerHTML = `
            <div class="nutrition-stats" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px;">
                <div class="nutrition-stat" style="text-align: center; background: #f8f9ff; padding: 15px; border-radius: 10px; border: 2px solid #e6e9ff;">
                    <div class="stat-label" style="font-size: 0.8rem; color: #666; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px;">Calories</div>
                    <div class="stat-value" style="font-size: 1.4rem; font-weight: bold; color: #667eea;">${Math.round(data.nutrition.calories)}</div>
                    <div class="stat-unit" style="font-size: 0.8rem; color: #888; margin-top: 2px;">cal</div>
                </div>
                <div class="nutrition-stat" style="text-align: center; background: #f8f9ff; padding: 15px; border-radius: 10px; border: 2px solid #e6e9ff;">
                    <div class="stat-label" style="font-size: 0.8rem; color: #666; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px;">Protein</div>
                    <div class="stat-value" style="font-size: 1.4rem; font-weight: bold; color: #4CAF50;">${data.nutrition.protein.toFixed(1)}</div>
                    <div class="stat-unit" style="font-size: 0.8rem; color: #888; margin-top: 2px;">g</div>
                </div>
                <div class="nutrition-stat" style="text-align: center; background: #f8f9ff; padding: 15px; border-radius: 10px; border: 2px solid #e6e9ff;">
                    <div class="stat-label" style="font-size: 0.8rem; color: #666; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px;">Carbs</div>
                    <div class="stat-value" style="font-size: 1.4rem; font-weight: bold; color: #FF9800;">${data.nutrition.carbs.toFixed(1)}</div>
                    <div class="stat-unit" style="font-size: 0.8rem; color: #888; margin-top: 2px;">g</div>
                </div>
                <div class="nutrition-stat" style="text-align: center; background: #f8f9ff; padding: 15px; border-radius: 10px; border: 2px solid #e6e9ff;">
                    <div class="stat-label" style="font-size: 0.8rem; color: #666; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px;">Fat</div>
                    <div class="stat-value" style="font-size: 1.4rem; font-weight: bold; color: #9C27B0;">${data.nutrition.fat.toFixed(1)}</div>
                    <div class="stat-unit" style="font-size: 0.8rem; color: #888; margin-top: 2px;">g</div>
                </div>
            </div>
            ${data.user_profile ? `
            <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-size: 0.9rem; opacity: 0.9;">Daily Calorie Goal</div>
                        <div style="font-size: 1.2rem; font-weight: bold;">${Math.round(data.user_profile.daily_calories)} cal</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 0.9rem; opacity: 0.9;">Progress</div>
                        <div style="font-size: 1.2rem; font-weight: bold;">${Math.min(calorieProgress, 100)}%</div>
                    </div>
                </div>
                <div style="margin-top: 10px; height: 8px; background: rgba(255, 255, 255, 0.2); border-radius: 4px; overflow: hidden;">
                    <div style="height: 100%; width: ${Math.min(calorieProgress, 100)}%; background: ${progressColor}; border-radius: 4px; transition: width 0.3s ease;"></div>
                </div>
                <div style="margin-top: 5px; font-size: 0.8rem; opacity: 0.9; text-align: center;">
                    ${Math.round(data.nutrition.calories)} / ${Math.round(data.user_profile.daily_calories)} calories
                </div>
            </div>
            ` : ''}
        `;
    } else {
        nutritionDiv.innerHTML = `
            <div style="text-align: center; color: #666; padding: 20px;">
                <i class="fas fa-chart-pie fa-2x" style="margin-bottom: 10px; color: #ccc;"></i>
                <p>Log food to see nutrition data</p>
            </div>
        `;
    }
    updateProgressDisplay(data);
}


// Add this new function:
function updateProgressDisplay(data) {
    const progressDiv = document.getElementById('nutritionProgress');
    
    if (!progressDiv) return;
    
    if (data.nutrition && Object.keys(data.nutrition).length > 0 && data.user_profile) {
        const calories = Math.round(data.nutrition.calories);
        const targetCalories = Math.round(data.user_profile.daily_calories);
        const progress = Math.min(100, Math.round((calories / targetCalories) * 100));
        
        progressDiv.innerHTML = `
            <div style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="font-weight: 600; color: #333;">Calories</span>
                    <span style="font-weight: 600; color: #667eea;">${calories} / ${targetCalories}</span>
                </div>
                <div style="height: 12px; background: #f0f2ff; border-radius: 6px; overflow: hidden;">
                    <div style="height: 100%; width: ${progress}%; background: ${progress > 100 ? '#ff6b6b' : '#667eea'}; border-radius: 6px; transition: width 0.3s ease;"></div>
                </div>
                <div style="text-align: center; margin-top: 5px; font-size: 0.9rem; color: #666;">
                    ${progress}% of daily goal
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px;">
                <div style="text-align: center; padding: 15px; background: #f8f9ff; border-radius: 10px;">
                    <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">Protein</div>
                    <div style="font-size: 1.3rem; font-weight: bold; color: #4CAF50;">${data.nutrition.protein.toFixed(1)}g</div>
                </div>
                <div style="text-align: center; padding: 15px; background: #f8f9ff; border-radius: 10px;">
                    <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">Carbs</div>
                    <div style="font-size: 1.3rem; font-weight: bold; color: #FF9800;">${data.nutrition.carbs.toFixed(1)}g</div>
                </div>
                <div style="text-align: center; padding: 15px; background: #f8f9ff; border-radius: 10px;">
                    <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">Fat</div>
                    <div style="font-size: 1.3rem; font-weight: bold; color: #9C27B0;">${data.nutrition.fat.toFixed(1)}g</div>
                </div>
                <div style="text-align: center; padding: 15px; background: #f8f9ff; border-radius: 10px;">
                    <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">Remaining</div>
                    <div style="font-size: 1.3rem; font-weight: bold; color: #667eea;">${Math.max(0, targetCalories - calories)}</div>
                    <div style="font-size: 0.8rem; color: #888;">calories</div>
                </div>
            </div>
        `;
    } else {
        // Default message when no data
        progressDiv.innerHTML = `
            <div style="text-align: center; color: #666; padding: 20px;">
                <i class="fas fa-chart-line fa-2x" style="margin-bottom: 10px; color: #ccc;"></i>
                <p>Log food to see your progress</p>
            </div>
        `;
    }
}

// Delete functions
function removeFoodEntry(foodName, quantity) {
    openDeleteModal(`Remove ${foodName} (${quantity} servings) from log?`, function() {
        removeFoodLog(foodName, quantity);
    });
}

function removeFoodLog(foodName, quantity) {
    const dateStr = currentDate.toISOString().split('T')[0];
    
    console.log('Removing food:', { foodName, quantity, dateStr });
    
    fetch('/api/remove_food', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            date: dateStr,
            food_name: foodName,
            quantity: quantity
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Remove response:', data);
        if (data.status === 'success') {
            showToast(`✅ Removed ${data.removed_count} entry(ies) for ${foodName}!`);
            loadDailySummary();
        } else {
            showToast('Error: ' + (data.error || 'Failed to remove food'), 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Error removing food', 'error');
    });
}

function clearDailyLogs() {
    const dateStr = currentDate.toISOString().split('T')[0];
    
    fetch('/api/clear_daily_logs', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ date: dateStr })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Clear logs response:', data);
        if (data.status === 'success') {
            showToast(data.message);
            loadDailySummary();
            closeClearLogsModal();
        } else {
            showToast('Error: ' + data.error, 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Error clearing logs', 'error');
    });
}

// Toast notification
function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = 'toast show';
    
    if (type === 'error') {
        toast.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #ff5252 100%)';
    } else {
        toast.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
    }
    
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// Debug functions
function debugFoodLogging() {
    console.log('=== Debug Food Logging ===');
    console.log('Current foodToLog:', foodToLog);
    console.log('Testing direct function calls:');
    
    // Test 1: Direct call to openQuantityModal
    console.log('\n1. Testing openQuantityModal with "Test Apple"...');
    openQuantityModal('Test Apple');
    
    // Test 2: Direct call to logFood after a delay
    setTimeout(() => {
        console.log('\n2. Testing logFood with "Test Banana"...');
        logFood('Test Banana', 1);
    }, 1000);
    
    // Test 3: Check if search results are displayed
    console.log('\n3. Checking search results container...');
    const searchResults = document.getElementById('searchResults');
    console.log('Search results container:', searchResults);
    console.log('InnerHTML length:', searchResults.innerHTML.length);
}

// Test function for specific food
function testWithEggs() {
    console.log('=== Testing with Eggs ===');
    // Simulate clicking on Eggs
    openQuantityModal('Eggs');
    
    setTimeout(() => {
        console.log('Submitting quantity for Eggs...');
        document.getElementById('quantityInput').value = '1';
        submitQuantity();
    }, 500);
}

// Make debug functions available globally
window.debugFoodLogging = debugFoodLogging;
window.testWithEggs = testWithEggs;

console.log('=== Food Log JavaScript Loaded ===');
console.log('Debug functions available:');
console.log('1. window.debugFoodLogging() - Run comprehensive debug tests');
console.log('2. window.testWithEggs() - Test adding Eggs to food log');
console.log('3. Open browser console (F12) to see detailed logs');
</script>
{% endblock %}